{% extends 'base.html' %}
{% load static %}
{% block title %} 
 Upload CSV
{% endblock title %}
Popular Products
{% block content %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- Include CountUp library -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/countup.js/2.0.7/countUp.min.js"></script>

<body>
  <div class="container">
    <div class="col-lg-3 col-6 text-center">
        <div class="border-dashed border-1 border-secondary border-radius-md py-3 bg-white">
            <h6 class="text-primary text-gradient mb-0">Total Profits</h6>
            <h4 class="font-weight-bolder"><span class="small">₹ </span><span id="state1" countTo="{{ total_profits }}"></span></h4>
        </div>
    </div>
    <div class="col-lg-3 col-6 text-center">
        <div class="border-dashed border-1 border-secondary border-radius-md py-3 bg-white">
            <h6 class="text-primary text-gradient mb-0">Total Revenue</h6>
            <h4 class="font-weight-bolder"><span class="small">₹ </span><span id="state2" countTo="{{ total_sales }}"></span></h4>
        </div>
    </div>
    <div class="col-lg-3 col-6 text-center mt-4 mt-lg-0">
        <div class="border-dashed border-1 border-secondary border-radius-md py-3 bg-white">
            <h6 class="text-primary text-gradient mb-0">{{ prime_category.category }}</h6>
            <h4 class="font-weight-bolder"><span class="small"></span> <span id="state3" countTo="{{prime_category.total_quantity}}"></span></h4>
        </div>
    </div>
    <div class="col-lg-3 col-6 text-center mt-4 mt-lg-0">
        <div class="border-dashed border-1 border-secondary border-radius-md py-3 bg-white">
            <h6 class="text-primary text-gradient mb-0">Total Quantity Sold</h6>
            <h4 class="font-weight-bolder"><span id="state4" countTo="{{ total_quantity_sold }}"></span><span class="small"></span></h4>
        </div>
    </div>
</div>
</div>
     
    <div class="container">
    
    <!-- Left div for the chart -->
    <div class="left-div">
        <div class="card">
            <div class="card-body">
                <center><h5>Popular Products</h5></center>
                <canvas id="bar-chart" height="200px" class="chart-canvas"></canvas>
            </div>
        </div>
    </div>
    <!-- Right div for other content -->
    <div class="card mb-3">
        <div class="card-body p-3">
            <div class="chart">
                <center><h5>Profit - Sub Category</h5></center>

                <canvas id="doughnut-chart" height="20px"></canvas>
            </div>
        </div>
    </div>
</div>

<div class="container">
    <div class="row">
        {% for category_data in top_categories_subcategories %}
                <div class="col-lg-4 col-md-6 mb-4">
                    <div class="card">
                        <div class="card-header p-0 mx-3 mt-3 position-relative z-index-1">
                            <center><h5>   {{ category_data.category }}</h5></center>
                         
                            <a href="javascript:;" class="d-block">
                                {% if forloop.counter == 1 %}
                                    <img src="{% static 'assets/img/dalle1.jpeg' %}" class="img-fluid border-radius-lg">
                                {% elif forloop.counter == 2 %}
                                    <img src="{% static 'assets/img/dalle3.jpeg' %}" class="img-fluid border-radius-lg">
                                {% elif forloop.counter == 3 %}
                                    <img src="{% static 'assets/img/dalle2.jpeg' %}" class="img-fluid border-radius-lg">
                                {% endif %}
                            </a>
                        </div>
                        
                        <div class="card-body pt-4">
                            {% for subcategory_data in category_data.subcategories %}

                            <h5>{{ subcategory_data.sub_category }} - Quantity: {{ subcategory_data.total_quantity }}</h5>
                            {% endfor %}

                        </div>
                    </div>
                </div>
        {% endfor %}
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>



        
    </div>
</div>
<script src="{% static 'assets/js/plugins/countup.min.js' %}"></script>
<div class="container">
    <div class="row">
        <!-- Left column for the first two charts -->
        <div class="col-md-6">
            <!-- First chart -->
            <div class="card mb-3">
                <div class="card-body p-3">
                    <center><h4>Profit by Month</h4></center>
                    <div class="chart">
                        <canvas id="mixed-chart" class="chart-canvas" height="300px"></canvas>
                    </div>
                </div>
            </div>
            <!-- Second chart -->
            <div class="card mb-6">
                <div class="card-body p-3">
                  
                </div>
            </div>
        </div>
        <!-- Right column for the other two charts -->
        <div class="col-md-6">
       
            <!-- Fourth chart -->
            <div class="card mb-3">
                <div class="card-body p-3">
                    <div class="chart">
                        <center><h4>Payment %</h4></center>
                        <canvas id="pie-chart-payment-mode" class="chart-canvas" height="300px"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Chart for profit by month
    var mixedChart = new Chart(document.getElementById('mixed-chart'), {
        type: 'bar',
        data: {
            labels: ['January', 'February', 'March', 'April', 'May', 'June'],
            datasets: [{
                label: 'Profit',
                data: [2000, 3000, 2500, 3500, 2800, 4000],
                backgroundColor: '#172b4d' // Default color
            }]
        },
        options: {}
    });

    // Modified profit data with merged monthly values
    var mergedProfitData = [
        { month: 'January', total_profit: 2000 },
        { month: 'February', total_profit: 3000 },
        { month: 'March', total_profit: 2500 },
        { month: 'April', total_profit: 3500 },
        { month: 'May', total_profit: 2800 },
        { month: 'June', total_profit: 4000 },
        { month: 'July', total_profit: 18238 },
        { month: 'August', total_profit: 2157 },
        { month: 'September', total_profit: 1185 },
        { month: 'October', total_profit: 3306 },
        { month: 'November', total_profit: 3667 },
        { month: 'December', total_profit: -1915 }
    ];

    // Extracting labels and data from the merged profit data
    var mergedProfitLabels = mergedProfitData.map(function(item) {
        return item.month;
    });

    var mergedProfitValues = mergedProfitData.map(function(item) {
        return item.total_profit;
    });

    // Update mixed chart with merged profit data
    mixedChart.data.labels = mergedProfitLabels;
    mixedChart.data.datasets[0].data = mergedProfitValues;
    mixedChart.update();

    // Chart for total quantity by payment mode
    var polarChart = new Chart(document.getElementById('polar-chart-total-quantity-by-payment-mode'), {
        type: 'polarArea',
        data: {
            labels: ['Cash', 'Credit Card', 'Debit Card', 'Net Banking'],
            datasets: [{
                label: 'Total Quantity',
                data: [100, 150, 120, 180],
                backgroundColor: ['#11cdef', '#f5365c', '#fb6340', '#172b4d'] // Info color
            }]
        },
        options: {}
    });

    // Chart for payment mode
    var pieChart = new Chart(document.getElementById('pie-chart-payment-mode'), {
        type: 'pie',
        data: {
            labels: ['Cash', 'Credit Card', 'Debit Card', 'Net Banking'],
            datasets: [{
                label: 'Payment Mode',
                data: [30, 20, 25, 25],
                backgroundColor: ['#2dce89', '#f5365c', '#fb6340', '#172b4d'] // Success, Danger, Warning, Default colors
            }]
        },
        options: {
            tooltips: {
                callbacks: {
                    label: function(tooltipItem, data) {
                        var dataset = data.datasets[tooltipItem.datasetIndex];
                        var total = dataset.data.reduce(function(previousValue, currentValue, currentIndex, array) {
                            return previousValue + currentValue;
                        });
                        var currentValue = dataset.data[tooltipItem.index];
                        var percentage = Math.floor(((currentValue / total) * 100) + 0.5);
                        return percentage + '%';
                    }
                }
            }
        }
    });
</script>

<script>
    // Function to count from zero to a target number
    function countTo(elementId, targetNumber) {
      var element = document.getElementById(elementId);
      var currentNumber = 0;
      var increment = Math.ceil(targetNumber / 100); // Adjust the speed of counting here
  
      // Interval function to increment the number
      var interval = setInterval(function() {
        currentNumber += increment;
        element.textContent = currentNumber.toLocaleString(); // Format the number with commas
        if (currentNumber >= targetNumber) {
          clearInterval(interval); // Stop the interval when target number is reached
          element.textContent = targetNumber.toLocaleString(); // Ensure exact target number is displayed
        }
      }, 20); // Adjust the interval timing here (smaller values make it faster)
    }
  
    // Call countTo function for each element with countTo attribute
    document.addEventListener('DOMContentLoaded', function() {
      var elements = document.querySelectorAll('[countTo]');
      elements.forEach(function(el) {
        var targetNumber = parseInt(el.getAttribute('countTo'));
        countTo(el.id, targetNumber);
      });
    });
  </script>
  

  
              
        </div>
    </div>
</div>
</div>
<script>
    document.addEventListener('DOMContentLoaded', function() {
    // CountUp initialization code here
    if (document.getElementById('state1')) {
        const countUp1 = new CountUp('state1', document.getElementById("state1").getAttribute("countTo"));
        if (!countUp1.error) {
            countUp1.start();
        } else {
            console.error(countUp1.error);
        }
    }

    // Repeat the same process for other count elements (state2, state3, state4)
});
</script>
<!-- <div class="left-div">
<h4>  </h4>
 -->

 <script src="{% static 'assets/js/plugins/countup.min.js' %}"></script>
 <script>
   // Wait for the DOM content to load
   document.addEventListener('DOMContentLoaded', function() {
     // Initialize CountUp for state1
     if (document.getElementById('state1')) {
       const countUp1 = new CountUp('state1', parseInt(document.getElementById('state1').getAttribute('countTo')));
       if (!countUp1.error) {
         countUp1.start();
       } else {
         console.error(countUp1.error);
       }
     }
 
     // Initialize CountUp for state2
     if (document.getElementById('state2')) {
       const countUp2 = new CountUp('state2', parseInt(document.getElementById('state2').getAttribute('countTo')));
       if (!countUp2.error) {
         countUp2.start();
       } else {
         console.error(countUp2.error);
       }
     }
 
     // Initialize CountUp for state3
     if (document.getElementById('state3')) {
       const countUp3 = new CountUp('state3', parseInt(document.getElementById('state3').getAttribute('countTo')));
       if (!countUp3.error) {
         countUp3.start();
       } else {
         console.error(countUp3.error);
       }
     }
 
     // Initialize CountUp for state4
     if (document.getElementById('state4')) {
       const countUp4 = new CountUp('state4', parseInt(document.getElementById('state4').getAttribute('countTo')));
       if (!countUp4.error) {
         countUp4.start();
       } else {
         console.error(countUp4.error);
       }
     }
   });
 </script>
 <script>
    // Initialize arrays to store labels and data
    const stateLabels = [];
    const stateTotalAmounts = [];

    // Iterate over the queryset and populate arrays
    {% for item in total_amount_by_state %}
        stateLabels.push('{{ item.state }}');
        stateTotalAmounts.push('{{ item.total_amount }}');
    {% endfor %}

    // Construct the data object for the chart
    const totalAmountByStateData = {
        labels: stateLabels,
        datasets: [{
            label: 'Total Amount',
            backgroundColor: '#5e72e4', // Use the Primary color
            borderColor: '#5e72e4', // Use the Primary color
            data: stateTotalAmounts
        }]
    };

    // Create the chart
    new Chart(document.getElementById('chart-total-amount-by-state'), {
        type: 'bar',
        data: totalAmountByStateData,
        options: {
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero: true
                    }
                }]
            }
        }
    });
</script>
<script>
    // JavaScript for rendering the chart (same as before)
    var monthly_most_sold_data = {{ monthly_most_sold_list|safe }};
    var categories = monthly_most_sold_data.map(item => item.category + ' - ' + item.sub_category);
    var quantities = monthly_most_sold_data.map(item => item.total_quantity);

    var ctx = document.getElementById('bar-chart').getContext('2d');
    var myChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: categories,
            datasets: [{
                label: 'Total Quantity Sold',
                data: quantities,
                backgroundColor: 'rgba(0, 0, 128, 0.5)', // Dark blue background color
                borderColor: '#172b4d', // Dark blue border color
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero: true
                    }
                }]
            }
        }
    });
</script>
<script>
    // Data for the doughnut chart
    var data = {
        labels: [{% for item in top_profit_subcategories %}'{{ item.sub_category }}',{% endfor %}],
        datasets: [{
            label: 'Total Profit',
            data: [{% for item in top_profit_subcategories %}{{ item.total_profit }},{% endfor %}],
            backgroundColor: [
            '#172b4d',  // Default (Dark Blue)
                '#5e72e4',  // Primary (Blue)
                '#11cdef',  // Info (Light Blue)
                '#f4f5f7',  // Secondary (Light Gray)
                '#2dce89',  // Success (Green)
                '#f5365c',  // Danger (Red)
                '#fb6340'    // Warning (Orange)
            ],
            borderColor: [
                '#172b4d',  // Default (Dark Blue)
                '#5e72e4',  // Primary (Blue)
                '#11cdef',  // Info (Light Blue)
                '#f4f5f7',  // Secondary (Light Gray)
                '#2dce89',  // Success (Green)
                '#f5365c',  // Danger (Red)
                '#fb6340'   // Warning (Orange)
            ],
            borderWidth: 1
        }]
    };

    // Options for the doughnut chart
    var options = {
        // Add your options here
    };

    // Get the canvas element
    var ctx = document.getElementById('doughnut-chart').getContext('2d');

    // Create the doughnut chart
    var myChart = new Chart(ctx, {
        type: 'doughnut',
        data: data,
        options: options
    });
    

</script>
<script>
    if (document.getElementById('state1')) {
    const countUp = new CountUp('state1', document.getElementById("state1").getAttribute("countTo"));
    if (!countUp.error) {
      countUp.start();
    } else {
      console.error(countUp.error);
    }
  }
  if (document.getElementById('state2')) {
    const countUp = new CountUp('state2', document.getElementById("state2").getAttribute("countTo"));
    if (!countUp.error) {
      countUp.start();
    } else {
      console.error(countUp.error);
    }
  }
  if (document.getElementById('state3')) {
    const countUp = new CountUp('state3', document.getElementById("state3").getAttribute("countTo"));
    if (!countUp.error) {
      countUp.start();
    } else {
      console.error(countUp.error);
    }
  }
  if (document.getElementById('state4')) {
    const countUp = new CountUp('state4', document.getElementById("state4").getAttribute("countTo"));
    if (!countUp.error) {
      countUp.start();
    } else {
      console.error(countUp.error);
    }
  }
</script>

</body>

<style>
    /* Global styles */
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
    }

    /* Container styles */
    .container {
        display: flex;
        justify-content: space-between;
        padding: 20px;
        background-color: #f8f9fa;
    }

    /* Left div styles */
    .left-div {
        width: 60%;
        background-color: #fff;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    /* Right div styles */
    .right-div {
        width: 40%;
        background-color: #fff;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    /* Card styles */
    .card {
        margin: 20px;
        padding: 20px;
    }

    .card h5 {
        margin-bottom: 10px;
    }

    /* Chart canvas styles */
    .chart-canvas {
        width: 100%;

    }

</style>

</html>
{% endblock %}