{% extends 'base.html' %}
{% load static %}
{% block title %} 
    Customer Review Analysis
{% endblock title %}
{% block content %}
<style>
    /* Add border to the table */
#commentsTable {
    border: 1px solid #ddd;
    border-collapse: collapse;
    width: 100%;
}

/* Add styles for table cells */
#commentsTable th, #commentsTable td {
    border: 1px solid #ddd;
    padding: 8px;
    text-align: left;
}

/* Add hover effect to table rows */
#commentsTable tbody tr:hover {
    background-color: #f5f5f5;
}

/* Compact the table */
#commentsTable td {
    max-width: 300px; /* Adjust as needed */
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

/* Add box around the chart */
.summary-chart-container {
    border: 1px solid #ddd;
    padding: 10px;
    margin-top: 10px;
    max-width: 750px; /* Adjust as needed */
}

/* Add space between summary and chart */
#summarySection {
    margin-bottom: 20px;
}

/* Add animation class */
.chart-animation {
    animation: fadeIn 1s ease-in-out;
}

@keyframes fadeIn {
    from {
        opacity: 0;
    }
    to {
        opacity: 1;
    }
}

</style>

<div class="container mt-5">
    <form id="analysisForm" action="{% url 'reviews' %}" method="post" class="mb-4">
        {% csrf_token %}
        <div class="input-group">
            <input type="text" name="video_url" class="form-control" placeholder="Enter YouTube URL" required>
            <button type="submit" class="btn btn-primary">Analyze</button>
        </div>
    </form>
    <br><br><br>
    {% if summary %}
    <div id="summarySection" class="mt-4">
        <h2 class="mb-3">Summary</h2>
        <div class="row">
            <div class="col-md-6">
                <p>Positive: {{ summary.positive }}</p>
                <p>Negative: {{ summary.negative }}</p>
            </div>
            <div class="col-md-6">
                <p>Number of Comments: {{ summary.num_comments }}</p>
                <p>Rating: {{ summary.rating }}%</p>
            </div>
        </div>
        <div class="summary-chart-container">
            <canvas id="chart" width="700" height="350"></canvas>
        </div>
    </div>

    <div class="comments-container mt-2">
        <h3 class="mb-3">Comments</h3>
        <div class="container-fluid p-0">
            <table id="commentsTable" class="table table-striped">
                <thead>
                    <tr>
                        <th>Comment</th>
                        <th>Sentiment</th>
                    </tr>
                </thead>
                <tbody>
                    {% for comment, sentiment in comments %}
                    <tr>
                        <td>{{ comment }}</td>
                        <td>{{ sentiment }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    
    {% endif %}
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Chart.js

    // Add animations and popups to the table
    document.addEventListener('DOMContentLoaded', function () {
        var commentsTable = document.getElementById('commentsTable');

        if (commentsTable) {
            // Add animations or popups as needed
            // Example: Add a popup on table cell click
            commentsTable.addEventListener('click', function (event) {
                var target = event.target;
                if (target.tagName === 'TD') {
                    alert('You clicked on: ' + target.textContent);
                }
            });
        }
    });

    function updateChart() {
        var ctx = document.getElementById('chart').getContext('2d');
        if (window.myChart !== undefined) {
            window.myChart.destroy();
        }

        window.myChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['Positive', 'Negative'],
                datasets: [{
                    label: 'Sentiment Distribution',
                    data: [
                        {{ summary.positive|default:0 }},
                        {{ summary.negative|default:0 }},
                    ],
                    backgroundColor: [
                        'rgba(75, 192, 192, 0.2)',
                        'rgba(255, 99, 132, 0.2)',
                    ],
                    borderColor: [
                        'rgba(75, 192, 192, 1)',
                        'rgba(255, 99, 132, 1)',
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: false, // Disable responsive behavior
                scales: {
                    y: {
                        beginAtZero: true,
                        max: Math.ceil({{ summary.num_comments }} / 100) * 100,
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        callbacks: {
                            label: function (context) {
                                var label = context.dataset.label || '';
                                if (label) {
                                    label += ': ';
                                }
                                if (context.parsed.y !== null) {
                                    label += context.parsed.y + ' %';
                                }
                                return label;
                            }
                        }
                    }
                }
            }
        });
    }

    // Call the updateChart function when the document is ready
    document.addEventListener('DOMContentLoaded', function () {
        updateChart();
    });
</script>
<script src="{% static 'script.js' %}"></script>

{% endblock %}
